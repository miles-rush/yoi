import{e as c,u as _,f as N,h as E,r as s,o as k,c as S,b as p,a as e,w as a,F as R,i as G,j as H,k as x,l as J,t as i,d as f,g as K}from"./index.0e20a458.js";const O={class:"leave-manage"},P={class:"query-form"},Q=f("\u67E5\u8BE2"),W=f("\u91CD\u7F6E"),X={class:"base-table"},Y=p("div",{class:"action"},null,-1),Z=f("\u5BA1\u6838"),ee=f("\u5BA1\u6838\u901A\u8FC7"),te=f("\u9A73\u56DE"),re={__name:"Approve",setup(ae){const{proxy:d}=K(),y=c({applyState:1}),M=c([{label:"\u5355\u53F7",prop:"orderNo"},{label:"\u7533\u8BF7\u4EBA",prop:"",formatter(l){return l.applyUser.userName}},{label:"\u4F11\u5047\u65F6\u95F4",prop:"",width:"200px",formatter(l){return _.formateDate(new Date(l.startTime),"yyyy-MM-dd")+" \u5230 "+_.formateDate(new Date(l.endTime),"yyyy-MM-dd")}},{label:"\u4F11\u5047\u65F6\u957F",prop:"leaveTime"},{label:"\u4F11\u5047\u7C7B\u578B",prop:"applyType",formatter(l,t,r){return{1:"\u4E8B\u5047",2:"\u8C03\u4F11",3:"\u5E74\u5047"}[r]}},{label:"\u4F11\u5047\u539F\u56E0",prop:"reasons"},{label:"\u7533\u8BF7\u65F6\u95F4",prop:"createTime",formatter:(l,t,r)=>_.formateDate(new Date(r))},{label:"\u5BA1\u6279\u4EBA",prop:"auditUsers"},{label:"\u5F53\u524D\u5BA1\u6279\u4EBA",prop:"curAuditUserName"},{label:"\u5BA1\u6279\u72B6\u6001",prop:"applyState",formatter:(l,t,r)=>({1:"\u5F85\u5BA1\u6279",2:"\u5BA1\u6279\u4E2D",3:"\u5BA1\u6279\u62D2\u7EDD",4:"\u5BA1\u6279\u901A\u8FC7",5:"\u4F5C\u5E9F"})[r]}]),v=c({pageNum:1,pageSize:10,total:0}),C=N([]),b=N(!1),U=c({remark:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BA1\u6838\u5907\u6CE8",trigger:["change","blur"]}]}),u=N({}),A=d.$store.state.userInfo,g=c({remark:""});E(()=>{w()});const w=async()=>{let l={...y,...v,type:"approve"},{list:t,page:r}=await d.$api.getApplyList(l);C.value=t,v.total=r.total},F=l=>{v.pageNum=l,w()},D=l=>{d.$refs[l].resetFields()},B=l=>{b.value=!0;let t={...l};t.applyTypeName={1:"\u4E8B\u5047",2:"\u8C03\u4F11",3:"\u5E74\u5047"}[t.applyType],t.time=_.formateDate(new Date(l.startTime),"yyyy-MM-dd")+" \u5230 "+_.formateDate(new Date(l.endTime),"yyyy-MM-dd"),t.applyStateName={1:"\u5F85\u5BA1\u6279",2:"\u5BA1\u6279\u4E2D",3:"\u5BA1\u6279\u62D2\u7EDD",4:"\u5BA1\u6279\u901A\u8FC7",5:"\u4F5C\u5E9F"}[t.applyState],u.value=t},L=()=>{b.value=!1,D("dialogForm")},V=l=>{d.$refs.dialogForm.validate(async t=>{if(t){let r={action:l,remark:g.remark,_id:u.value._id};try{let h=await d.$api.leaveApprove(r);L(),d.$message.success("\u5904\u7406\u6210\u529F"),w(),d.$store.commit("saveNoticeCount",d.$store.state.noticeCount-1)}catch{}}})};return(l,t)=>{const r=s("el-option"),h=s("el-select"),n=s("el-form-item"),m=s("el-button"),T=s("el-form"),$=s("el-table-column"),q=s("el-table"),z=s("el-pagination"),I=s("el-input"),j=s("el-dialog");return k(),S("div",O,[p("div",P,[e(T,{ref:"form",inline:!0,model:y},{default:a(()=>[e(n,{label:"\u5BA1\u6279\u72B6\u6001",prop:"applyState"},{default:a(()=>[e(h,{modelValue:y.applyState,"onUpdate:modelValue":t[0]||(t[0]=o=>y.applyState=o)},{default:a(()=>[e(r,{value:"",label:"\u5168\u90E8"}),e(r,{value:1,label:"\u5F85\u5BA1\u6279"}),e(r,{value:2,label:"\u5BA1\u6279\u4E2D"}),e(r,{value:3,label:"\u5BA1\u6279\u62D2\u7EDD"}),e(r,{value:4,label:"\u5BA1\u6279\u901A\u8FC7"}),e(r,{value:5,label:"\u4F5C\u5E9F"})]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:a(()=>[e(m,{onClick:w,type:"primary"},{default:a(()=>[Q]),_:1}),e(m,{onClick:t[1]||(t[1]=o=>D("form"))},{default:a(()=>[W]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",X,[Y,e(q,{data:C.value},{default:a(()=>[(k(!0),S(R,null,G(M,o=>(k(),x($,{key:o.prop,prop:o.prop,label:o.label,width:o.width,formatter:o.formatter},null,8,["prop","label","width","formatter"]))),128)),e($,{label:"\u64CD\u4F5C",width:"150"},{default:a(o=>[o.row.curAuditUserName==H(A).userName&&[1,2].includes(o.row.applyState)?(k(),x(m,{key:0,size:"small",onClick:le=>B(o.row)},{default:a(()=>[Z]),_:2},1032,["onClick"])):J("",!0)]),_:1})]),_:1},8,["data"]),e(z,{class:"pagination",background:"",layout:"prev, pager, next",total:v.total,onCurrentChange:F},null,8,["total"])]),e(j,{title:"\u5BA1\u6838",width:"50%",modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=o=>b.value=o),"destroy-on-close":""},{footer:a(()=>[e(m,{onClick:t[3]||(t[3]=o=>V("pass"))},{default:a(()=>[ee]),_:1}),e(m,{onClick:t[4]||(t[4]=o=>V("refuse")),type:"primary"},{default:a(()=>[te]),_:1})]),default:a(()=>[e(T,{ref:"dialogForm",model:g,"label-width":"120px","label-suffix":":",rules:U},{default:a(()=>[e(n,{label:"\u7533\u8BF7\u4EBA"},{default:a(()=>[p("div",null,i(u.value.applyUser.userName),1)]),_:1}),e(n,{label:"\u4F11\u5047\u7C7B\u578B"},{default:a(()=>[p("div",null,i(u.value.applyTypeName),1)]),_:1}),e(n,{label:"\u4F11\u5047\u65F6\u95F4"},{default:a(()=>[p("div",null,i(u.value.time),1)]),_:1}),e(n,{label:"\u4F11\u5047\u65F6\u957F"},{default:a(()=>[p("div",null,i(u.value.leaveTime),1)]),_:1}),e(n,{label:"\u4F11\u5047\u539F\u56E0"},{default:a(()=>[p("div",null,i(u.value.reasons),1)]),_:1}),e(n,{label:"\u5BA1\u6279\u72B6\u6001"},{default:a(()=>[p("div",null,i(u.value.applyStateName),1)]),_:1}),e(n,{label:"\u5BA1\u6279\u4EBA"},{default:a(()=>[p("div",null,i(u.value.curAuditUserName),1)]),_:1}),e(n,{label:"\u5907\u6CE8",prop:"remark"},{default:a(()=>[e(I,{type:"textarea",row:3,placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6838\u5907\u6CE8",modelValue:g.remark,"onUpdate:modelValue":t[2]||(t[2]=o=>g.remark=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}};export{re as default};
