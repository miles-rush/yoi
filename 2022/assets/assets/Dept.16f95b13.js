import{e as b,f as g,u as F,h as G,r,o as v,c as N,b as h,a as l,w as a,F as x,i as U,d as p,g as J,m as K,k as D,n as Q}from"./index.0e20a458.js";const W={class:"dept-manage"},X={class:"query-form"},Y=p("\u67E5\u8BE2"),Z=p("\u91CD\u7F6E"),ee={class:"base-table"},le={class:"action"},te=p("\u521B\u5EFA"),ae=p("\u7F16\u8F91"),oe=p("\u5220\u9664"),se={class:"dialog-footer"},ne=p("\u53D6\u6D88"),re=p("\u786E\u5B9A"),ie={__name:"Dept",setup(de){const{proxy:n}=J(),c=b({deptName:""}),I=g([{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{label:"\u8D1F\u8D23\u4EBA",prop:"userName"},{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",formatter(o,t,d){return F.formateDate(new Date(d))}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",formatter(o,t,d){return F.formateDate(new Date(d))}}]),y=g([]);b({pageNum:1,pageSize:10});const m=g(""),_=g(!1),V=g([]),s=b({parentId:[null]}),E=b({deptName:[{required:!0,message:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",trigger:"blur"}],userName:[{required:!0,message:"\u8BF7\u9009\u62E9\u8D1F\u8D23\u4EBA",trigger:"change"}]});G(()=>{f(),L()});const L=async()=>{const o=await n.$api.getAllUserList();V.value=o},f=async()=>{const o=await n.$api.getDeptList(c);y.value=o},k=o=>{n.$refs[o].resetFields()},q=()=>{c.deptName="",f()},B=()=>{m.value="create",_.value=!0},w=()=>{_.value=!1,k("dialogForm")},T=o=>{m.value="edit",_.value=!0,n.$nextTick(()=>{Object.assign(s,o)})},O=o=>{n.$confirm("\u662F\u5426\u786E\u8BA4\u5220\u9664\u90E8\u95E8","",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{m.value="delete";let t={_id:o,action:m.value};n.$api.deptOperate(t),n.$message.success("\u5220\u9664\u6210\u529F"),f()})},R=()=>{n.$refs.dialogForm.validate(async o=>{if(o){let t={...K(s),action:m.value};await n.$api.deptOperate(t),n.$message.success("\u64CD\u4F5C\u6210\u529F"),w(),f()}})},z=o=>{const[t,d,u]=o.split("/");Object.assign(s,{userId:t,userName:d,userEmail:u})};return(o,t)=>{const d=r("el-input"),u=r("el-form-item"),i=r("el-button"),$=r("el-form"),C=r("el-table-column"),S=r("el-table"),j=r("el-cascader"),A=r("el-option"),M=r("el-select"),H=r("el-dialog");return v(),N("div",W,[h("div",X,[l($,{inline:!0,ref:"queryFormRef",model:c},{default:a(()=>[l(u,{label:"\u90E8\u95E8\u540D\u79F0"},{default:a(()=>[l(d,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",modelValue:c.deptName,"onUpdate:modelValue":t[0]||(t[0]=e=>c.deptName=e)},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(i,{onClick:f,type:"primary"},{default:a(()=>[Y]),_:1}),l(i,{onClick:q},{default:a(()=>[Z]),_:1})]),_:1})]),_:1},8,["model"])]),h("div",ee,[h("div",le,[l(i,{type:"primary",onClick:B},{default:a(()=>[te]),_:1})]),l(S,{data:y.value,"row-key":"_id","tree-props":{children:"children"},stripe:""},{default:a(()=>[(v(!0),N(x,null,U(I.value,e=>(v(),D(C,Q({key:e.prop},e),null,16))),128)),l(C,{label:"\u64CD\u4F5C"},{default:a(e=>[l(i,{size:"small",type:"primary",onClick:P=>T(e.row)},{default:a(()=>[ae]),_:2},1032,["onClick"]),l(i,{size:"small",type:"danger",onClick:P=>O(e.row._id)},{default:a(()=>[oe]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),l(H,{title:m.value==="create"?"\u521B\u5EFA\u90E8\u95E8":"\u7F16\u8F91\u90E8\u95E8",modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=e=>_.value=e),onClose:t[6]||(t[6]=e=>k("dialogForm"))},{footer:a(()=>[h("span",se,[l(i,{onClick:w},{default:a(()=>[ne]),_:1}),l(i,{onClick:R,type:"primary"},{default:a(()=>[re]),_:1})])]),default:a(()=>[l($,{ref:"dialogForm",model:s,rules:E,"label-width":"120px"},{default:a(()=>[l(u,{label:"\u4E0A\u7EA7\u90E8\u95E8",prop:"parentId"},{default:a(()=>[l(j,{options:y.value,"show-all-levels":"",placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u90E8\u95E8",modelValue:s.parentId,"onUpdate:modelValue":t[1]||(t[1]=e=>s.parentId=e),props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",style:{width:"100%"}},null,8,["options","modelValue"])]),_:1}),l(u,{label:"\u90E8\u95E8\u540D\u79F0",prop:"deptName"},{default:a(()=>[l(d,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u540D\u79F0",modelValue:s.deptName,"onUpdate:modelValue":t[2]||(t[2]=e=>s.deptName=e)},null,8,["modelValue"])]),_:1}),l(u,{label:"\u8D1F\u8D23\u4EBA",prop:"userName"},{default:a(()=>[l(M,{placeholder:"\u8BF7\u8F93\u5165\u90E8\u95E8\u8D1F\u8D23\u4EBA\u540D\u79F0",modelValue:s.userName,"onUpdate:modelValue":t[3]||(t[3]=e=>s.userName=e),style:{width:"100%"},onChange:z},{default:a(()=>[(v(!0),N(x,null,U(V.value,e=>(v(),D(A,{key:e.userId,label:e.userName,value:`${e.userId}/${e.userName}/${e.userEmail}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"\u8D1F\u8D23\u4EBA\u90AE\u7BB1",prop:"userEmail"},{default:a(()=>[l(d,{placeholder:"\u8BF7\u8F93\u5165\u8D1F\u8D23\u4EBA\u90AE\u7BB1",modelValue:s.userEmail,"onUpdate:modelValue":t[4]||(t[4]=e=>s.userEmail=e),disabled:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}};export{ie as default};
