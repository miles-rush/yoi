import{e as C,f as u,u as M,h as ee,r as m,q as te,o as p,c as R,b as N,a,w as l,v as w,k as h,F as le,i as ae,d,t as oe,g as se}from"./index.0e20a458.js";const ne={class:"role-manage"},re={class:"query-form"},ie=d("\u67E5\u8BE2"),ce=d("\u91CD\u7F6E"),de={class:"base-table"},ue={class:"action"},me=d("\u521B\u5EFA"),pe=d("\u7F16\u8F91 "),_e=d("\u8BBE\u7F6E\u6743\u9650 "),fe=d("\u5220\u9664 "),he={class:"dialog-footer"},ge=d("\u53D6 \u6D88"),ve=d("\u786E \u5B9A"),ke={class:"dialog-footer"},ye=d("\u53D6 \u6D88"),be=d("\u786E \u5B9A"),we={__name:"Role",setup(Ce){const{proxy:i}=se(),V=C({roleName:"",remark:""}),K=u([]),$=u(null),q=u([{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{label:"\u5907\u6CE8",prop:"remark"},{label:"\u6743\u9650\u5217\u8868",prop:"permissionList",formatter(e,t,n){let r=[];return(n.halfCheckedKeys||[]).map(c=>{let x=L[c];c&&x&&r.push(L[c])}),r.join(",")}},{label:"\u66F4\u65B0\u65F6\u95F4",prop:"updateTime",formatter(e,t,n){return M.formateDate(new Date(n))}},{label:"\u521B\u5EFA\u65F6\u95F4",prop:"createTime",formatter(e,t,n){return M.formateDate(new Date(n))}}]),g=C({pageNum:1,pageSize:10,total:0}),_=C({roleName:"",remark:""}),v=u(!1),P=C({roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"}]}),k=u(""),y=u(!1),T=u(""),D=u(""),F=u([]),L=C({});ee(()=>{f(),U()});const U=async()=>{let e=await i.$api.getMenuList();F.value=e,W(e)},f=async()=>{let{list:e,page:t}=await i.$api.getRoleList({...V,...g});K.value=e,g.total=t.total},j=()=>{v.value=!0,k.value="create"},A=e=>{v.value=!0,k.value="edit";let t={_id:e._id,roleName:e.roleName,remark:e.remark};i.$nextTick(()=>{Object.assign(_,t)})},E=e=>{i.$confirm("\u662F\u5426\u5220\u9664\u89D2\u8272","",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await i.$api.roleOperate({_id:e,action:"delete"}),i.$message.success("\u5220\u9664\u6210\u529F"),f()})},z=e=>{i.$refs[e].resetFields()},I=e=>{g.pageNum=e,f()},O=()=>{v.value=!1,z("dialogForm")},J=()=>{i.$refs.dialogForm.validate(async e=>{if(e){let t={action:k.value,..._};await i.$api.roleOperate(t)&&(k.value=="create"?i.$message.success("\u521B\u5EFA\u6210\u529F"):i.$message.success("\u7F16\u8F91\u6210\u529F"),O(),f())}})},H=e=>{D.value=e._id,T.value=e.roleName,y.value=!0;const{checkedKeys:t}=e.permissionList;i.$nextTick(()=>{$.value.setCheckedKeys(t)})},G=()=>{y.value=!1},Q=async()=>{let e=$.value.getCheckedNodes(),t=$.value.getHalfCheckedKeys(),n=[],r=[];e.map(c=>{c.children?r.push(c._id):n.push(c._id)});let o={_id:D.value,permissionList:{checkedKeys:n,halfCheckedKeys:r.concat(t)}};await i.$api.updatePermission(o),y.value=!1,i.$message.success("\u64CD\u4F5C\u6210\u529F"),f()},W=e=>{let t={};const n=r=>{for(;r.length;){let o=r.pop();o.children&&o.action&&(t[o._id]=o.menuName),o.children&&!o.action&&n(o.children)}};n(JSON.parse(JSON.stringify(e))),Object.assign(L,t)};return(e,t)=>{const n=m("el-input"),r=m("el-form-item"),o=m("el-button"),c=m("el-form"),x=m("el-table-column"),X=m("el-table"),Y=m("el-pagination"),S=m("el-dialog"),Z=m("el-tree"),b=te("has");return p(),R("div",ne,[N("div",re,[a(c,{ref:"form",inline:!0,model:V},{default:l(()=>[a(r,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:l(()=>[a(n,{modelValue:V.roleName,"onUpdate:modelValue":t[0]||(t[0]=s=>V.roleName=s),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(r,null,{default:l(()=>[w((p(),h(o,{type:"primary",onClick:f},{default:l(()=>[ie]),_:1})),[[b,"role-query"]]),a(o,{onClick:t[1]||(t[1]=s=>z("form"))},{default:l(()=>[ce]),_:1})]),_:1})]),_:1},8,["model"])]),N("div",de,[N("div",ue,[w((p(),h(o,{type:"primary",onClick:j},{default:l(()=>[me]),_:1})),[[b,"role-create"]])]),a(X,{data:K.value,"row-key":"_id"},{default:l(()=>[(p(!0),R(le,null,ae(q.value,s=>(p(),h(x,{key:s.prop,prop:s.prop,label:s.label,formatter:s.formatter},null,8,["prop","label","formatter"]))),128)),a(x,{label:"\u64CD\u4F5C",width:"240"},{default:l(s=>[w((p(),h(o,{size:"small",onClick:B=>A(s.row)},{default:l(()=>[pe]),_:2},1032,["onClick"])),[[b,"role-edit"]]),w((p(),h(o,{size:"small",type:"primary",onClick:B=>H(s.row)},{default:l(()=>[_e]),_:2},1032,["onClick"])),[[b,"role-setting"]]),w((p(),h(o,{type:"danger",size:"small",onClick:B=>E(s.row._id)},{default:l(()=>[fe]),_:2},1032,["onClick"])),[[b,"role-delete"]])]),_:1})]),_:1},8,["data"]),a(Y,{"page-size":g.pageSize,total:g.total,background:"",class:"pagination",layout:"prev, pager, next",onCurrentChange:I},null,8,["page-size","total"])]),a(S,{title:k.value==="create"?"\u89D2\u8272\u521B\u5EFA":"\u89D2\u8272\u7F16\u8F91",modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=s=>v.value=s)},{footer:l(()=>[N("span",he,[a(o,{onClick:O},{default:l(()=>[ge]),_:1}),a(o,{type:"primary",onClick:J},{default:l(()=>[ve]),_:1})])]),default:l(()=>[a(c,{ref:"dialogForm",model:_,"label-width":"100px",rules:P},{default:l(()=>[a(r,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:l(()=>[a(n,{modelValue:_.roleName,"onUpdate:modelValue":t[2]||(t[2]=s=>_.roleName=s),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(r,{label:"\u5907\u6CE8",prop:"remark"},{default:l(()=>[a(n,{type:"textarea",rows:"2",modelValue:_.remark,"onUpdate:modelValue":t[3]||(t[3]=s=>_.remark=s),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),a(S,{title:"\u6743\u9650\u8BBE\u7F6E",modelValue:y.value,"onUpdate:modelValue":t[5]||(t[5]=s=>y.value=s)},{footer:l(()=>[N("span",ke,[a(o,{onClick:G},{default:l(()=>[ye]),_:1}),a(o,{type:"primary",onClick:Q},{default:l(()=>[be]),_:1})])]),default:l(()=>[a(c,{"label-width":"100px"},{default:l(()=>[a(r,{label:"\u89D2\u8272\u540D\u79F0"},{default:l(()=>[d(oe(T.value),1)]),_:1}),a(r,{label:"\u9009\u62E9\u6743\u9650"},{default:l(()=>[a(Z,{ref_key:"permissionTree",ref:$,data:F.value,"show-checkbox":"","node-key":"_id","default-expand-all":"",props:{label:"menuName"}},null,8,["data"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{we as default};
