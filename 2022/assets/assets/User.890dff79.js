import{_ as M,f as g,e as F,u as S,h as Q,r as m,q as P,o as y,c as B,b as z,a as o,w as n,v as E,k as I,F as O,i as G,g as J,m as K,d as V}from"./index.0e20a458.js";const W={name:"user",setup(){const{proxy:r}=J(),t=[{type:"input",label:"\u7528\u6237ID",model:"userId",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237ID"},{type:"input",label:"\u7528\u6237\u540D\u79F0",model:"userName",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},{type:"select",label:"\u72B6\u6001",model:"state",placeholder:"\u8BF7\u9009\u62E9\u72B6\u6001",options:[{label:"\u6240\u6709",value:0},{label:"\u5728\u804C",value:1},{label:"\u79BB\u804C",value:2},{label:"\u8BD5\u7528\u671F",value:3}]}],L=g({state:0}),e=g([]),b=g(!1),_=F({pageNum:1,pageSize:5}),k=F([{type:"selection"},{label:"\u7528\u6237ID",prop:"userId"},{label:"\u7528\u6237\u540D",prop:"userName"},{label:"\u7528\u6237\u90AE\u7BB1",prop:"userEmail"},{label:"\u7528\u6237\u89D2\u8272",prop:"role",formatter(a,s,d){return{0:"\u7BA1\u7406\u5458",1:"\u666E\u901A\u7528\u6237"}[d]}},{label:"\u7528\u6237\u72B6\u6001",prop:"state",formatter(a,s,d){return{1:"\u5728\u804C",2:"\u79BB\u804C",3:"\u8BD5\u7528\u671F"}[d]}},{label:"\u6CE8\u518C\u65F6\u95F4",prop:"createTime",formatter:(a,s,d)=>S.formateDate(new Date(d))},{label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4",prop:"lastLoginTime",formatter:(a,s,d)=>S.formateDate(new Date(d))},{label:"\u64CD\u4F5C",type:"action",width:150,list:[{text:"\u7F16\u8F91",type:"primary"},{text:"\u5220\u9664",type:"danger"}]}]),c=g([]),h=F({userName:"",state:3}),f=g([]),i=g([]),u=g("add"),C=F({userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0",trigger:"blur"}],userEmail:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}],mobile:[{pattern:/1[3-9]\d{9}/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\u683C\u5F0F",trigger:"blur"}],deptId:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1",trigger:"blur"}]});Q(()=>{p(),x(),N()});const p=async()=>{let a={...L.value,..._};const{list:s,page:d}=await r.$api.getUserList(a);e.value=s,_.total=d.total},D=()=>{p()},v=a=>{r.$refs[a].resetFields()},w=a=>{_.pageNum=a,p()},l=a=>{r.$confirm("\u662F\u5426\u5220\u9664\u89D2\u8272","",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await r.$api.userDel({userIds:[a.userId]}),r.$message.success("\u5220\u9664\u6210\u529F"),p()})},T=()=>{if(c.value.length==0){r.$message.info("\u8BF7\u9009\u62E9\u8981\u5220\u9664\u7684\u7528\u6237");return}r.$confirm("\u662F\u5426\u5220\u9664\u89D2\u8272","",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{(await r.$api.userDel({userIds:c.value})).modifiedCount>0?(r.$message.success("\u5220\u9664\u6210\u529F"),p()):r.$message.error("\u5220\u9664\u5931\u8D25")})},q=a=>{let s=[];a.map(d=>{s.push(d.userId)}),c.value=s},A=()=>{u.value="add",b.value=!0},N=async()=>{const a=await r.$api.getRoleAllList();f.value=a},x=async()=>{const a=await r.$api.getDeptList();i.value=a},H=()=>{b.value=!1,v("dialogForm")},R=()=>{r.$refs.dialogForm.validate(async a=>{if(a){let s=K(h);s.userEmail+="@imooc.com",s.action=u.value,await r.$api.userSubmit(s),b.value=!1,u.value==="edit"?r.$message.success("\u7528\u6237\u4FEE\u6539\u6210\u529F"):r.$message.success("\u7528\u6237\u521B\u5EFA\u6210\u529F"),v("dialogForm"),p()}})},j=({index:a,row:s})=>{a==0?U(s):a==1&&l(s)},U=a=>{u.value="edit",b.value=!0,r.$nextTick(()=>{Object.assign(h,a)})};return{form:t,user:L,userList:e,columns:k,checkedUserIds:c,showModal:b,getUserList:p,getRoleAllList:N,getDeptList:x,roleList:f,deptList:i,pager:_,userForm:h,rules:C,action:u,handleQuery:D,handleReset:v,handleCurrentChange:w,handleDelete:l,handlePatchDel:T,handleSelectionChange:q,handleCreate:A,handleClose:H,handleSubmit:R,handleEdit:U,handleAction:j}}},X={class:"user-manage"},Y={class:"query-form"},Z=V("\u65B0\u589E"),$=V("\u6279\u91CF\u5220\u9664"),ee=V("@imooc.com"),le=V("\u53D6 \u6D88"),ae=V("\u786E \u5B9A");function oe(r,t,L,e,b,_){const k=m("query-form"),c=m("el-button"),h=m("base-table"),f=m("el-input"),i=m("el-form-item"),u=m("el-option"),C=m("el-select"),p=m("el-cascader"),D=m("el-form"),v=m("el-dialog"),w=P("has");return y(),B("div",X,[z("div",Y,[o(k,{form:e.form,modelValue:e.user,"onUpdate:modelValue":t[0]||(t[0]=l=>e.user=l),onHandleQuery:e.handleQuery},null,8,["form","modelValue","onHandleQuery"])]),o(h,{columns:e.columns,data:e.userList,pager:e.pager,onSelectionChange:e.handleSelectionChange,onHandleAction:e.handleAction,onHandleCurrentChange:e.handleCurrentChange},{action:n(()=>[E((y(),I(c,{onClick:e.handleCreate,type:"primary"},{default:n(()=>[Z]),_:1},8,["onClick"])),[[w,"user-create"]]),E((y(),I(c,{onClick:e.handlePatchDel,type:"danger"},{default:n(()=>[$]),_:1},8,["onClick"])),[[w,"user-patch-delete"]])]),_:1},8,["columns","data","pager","onSelectionChange","onHandleAction","onHandleCurrentChange"]),o(v,{title:e.action=="add"?"\u7528\u6237\u65B0\u589E":"\u7528\u6237\u7F16\u8F91",modelValue:e.showModal,"onUpdate:modelValue":t[8]||(t[8]=l=>e.showModal=l),onClose:t[9]||(t[9]=l=>e.handleReset("dialogForm"))},{footer:n(()=>[o(c,{onClick:e.handleClose},{default:n(()=>[le]),_:1},8,["onClick"]),o(c,{onClick:e.handleSubmit,type:"primary"},{default:n(()=>[ae]),_:1},8,["onClick"])]),default:n(()=>[o(D,{ref:"dialogForm",model:e.userForm,"label-width":"100px",rules:e.rules},{default:n(()=>[o(i,{label:"\u7528\u6237\u540D",prop:"userName"},{default:n(()=>[o(f,{modelValue:e.userForm.userName,"onUpdate:modelValue":t[1]||(t[1]=l=>e.userForm.userName=l),disabled:e.action=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D\u79F0"},null,8,["modelValue","disabled"])]),_:1}),o(i,{label:"\u90AE\u7BB1",prop:"userEmail"},{default:n(()=>[o(f,{modelValue:e.userForm.userEmail,"onUpdate:modelValue":t[2]||(t[2]=l=>e.userForm.userEmail=l),disabled:e.action=="edit",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1"},{append:n(()=>[ee]),_:1},8,["modelValue","disabled"])]),_:1}),o(i,{label:"\u624B\u673A\u53F7",prop:"mobile"},{default:n(()=>[o(f,{modelValue:e.userForm.mobile,"onUpdate:modelValue":t[3]||(t[3]=l=>e.userForm.mobile=l),placeholder:"\u8BF7\u8F93\u5165\u624B\u673A\u53F7"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u5C97\u4F4D",prop:"job"},{default:n(()=>[o(f,{modelValue:e.userForm.job,"onUpdate:modelValue":t[4]||(t[4]=l=>e.userForm.job=l),placeholder:"\u8BF7\u8F93\u5165\u5C97\u4F4D"},null,8,["modelValue"])]),_:1}),o(i,{label:"\u72B6\u6001",prop:"state"},{default:n(()=>[o(C,{modelValue:e.userForm.state,"onUpdate:modelValue":t[5]||(t[5]=l=>e.userForm.state=l)},{default:n(()=>[o(u,{value:1,label:"\u5728\u804C"}),o(u,{value:2,label:"\u79BB\u804C"}),o(u,{value:3,label:"\u8BD5\u7528\u671F"})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"\u7CFB\u7EDF\u89D2\u8272",prop:"roleList"},{default:n(()=>[o(C,{modelValue:e.userForm.roleList,"onUpdate:modelValue":t[6]||(t[6]=l=>e.userForm.roleList=l),placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u7CFB\u7EDF\u89D2\u8272",multiple:"",style:{width:"100%"}},{default:n(()=>[(y(!0),B(O,null,G(e.roleList,l=>(y(),I(u,{key:l._id,label:l.roleName,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"\u90E8\u95E8",prop:"deptId"},{default:n(()=>[o(p,{modelValue:e.userForm.deptId,"onUpdate:modelValue":t[7]||(t[7]=l=>e.userForm.deptId=l),placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u90E8\u95E8",options:e.deptList,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}var re=M(W,[["render",oe]]);export{re as default};
